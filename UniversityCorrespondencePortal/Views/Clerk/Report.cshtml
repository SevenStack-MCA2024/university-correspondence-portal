@{
    ViewBag.Title = "Clerk Dashboard";
    Layout = "~/Views/Shared/_ClerkLayout.cshtml";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>

<div class="container-fluid mt-4">
    <h2><i class="fas fa-tachometer-alt"></i> Clerk Dashboard</h2>
    <p class="text-muted">Department analytics and statistics for @ViewBag.DepartmentName</p>

    <!-- Summary Cards -->
    <div class="row mb-4">
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-primary shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                Total Staff
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">@ViewBag.TotalStaff</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-users fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-success shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                Letters This Month
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">@ViewBag.LettersThisMonth</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-envelope fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-info shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                Avg Processing Time
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">@ViewBag.AvgProcessingTime days</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-clock fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-warning shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                Pending Letters
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">@ViewBag.PendingLetters</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-exclamation-circle fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Row 1 -->
    <div class="row mb-4">
        <!-- Letters by Staff -->
        <div class="col-xl-6 col-lg-6">
            <div class="card shadow mb-4">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">Letters by Staff Member</h6>
                </div>
                <div class="card-body">
                    <div class="chart-bar">
                        <canvas id="lettersByStaffChart" height="250"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Letters by Month -->
        <div class="col-xl-6 col-lg-6">
            <div class="card shadow mb-4">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">Letters Processed by Month</h6>
                </div>
                <div class="card-body">
                    <div class="chart-area">
                        <canvas id="lettersByMonthChart" height="250"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Row 2 -->
    <div class="row mb-4">
        <!-- Inward vs Outward -->
        <div class="col-xl-4 col-lg-5">
            <div class="card shadow mb-4">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">Inward vs Outward Letters</h6>
                </div>
                <div class="card-body">
                    <div class="chart-pie pt-4 pb-2">
                        <canvas id="letterTypeChart" height="250"></canvas>
                    </div>
                    <div class="mt-4 text-center small">
                        <span class="mr-2">
                            <i class="fas fa-circle text-primary"></i> Inward (@ViewBag.InwardPercentage%)
                        </span>
                        <span class="mr-2">
                            <i class="fas fa-circle text-success"></i> Outward (@ViewBag.OutwardPercentage%)
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Priority Distribution -->
        <div class="col-xl-4 col-lg-5">
            <div class="card shadow mb-4">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">Letter Priority Distribution</h6>
                </div>
                <div class="card-body">
                    <div class="chart-pie pt-4 pb-2">
                        <canvas id="priorityChart" height="250"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Distribution -->
        <div class="col-xl-4 col-lg-5">
            <div class="card shadow mb-4">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">Letter Status Distribution</h6>
                </div>
                <div class="card-body">
                    <div class="chart-pie pt-4 pb-2">
                        <canvas id="statusChart" height="250"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Row 3 -->
    <div class="row">
        <!-- Sender Departments -->
        <div class="col-xl-6 col-lg-6">
            <div class="card shadow mb-4">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">Top Sender Departments</h6>
                </div>
                <div class="card-body">
                    <div class="chart-bar">
                        <canvas id="senderDepartmentsChart" height="250"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Processing Time Trends -->
        <div class="col-xl-6 col-lg-6">
            <div class="card shadow mb-4">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">Average Processing Time (Days)</h6>
                </div>
                <div class="card-body">
                    <div class="chart-bar">
                        <canvas id="processingTimeChart" height="250"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activity Table -->
    <div class="card shadow mb-4 mt-4">
        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary">Recent Letter Activity</h6>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered" id="recentActivityTable" width="100%" cellspacing="0">
                    <thead>
                        <tr>
                            <th>Letter #</th>
                            <th>Type</th>
                            <th>Subject</th>
                            <th>Assigned To</th>
                            <th>Date Received</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Letters by Staff Chart
        var ctx1 = document.getElementById('lettersByStaffChart');
        var lettersByStaffChart = new Chart(ctx1, {
            type: 'bar',
            data: {
                labels: @Html.Raw(Json.Encode(ViewBag.StaffNames)),
                datasets: [{
                    label: 'Letters Assigned',
                    data: @Html.Raw(Json.Encode(ViewBag.LettersByStaff)),
                    backgroundColor: '#4e73df',
                    hoverBackgroundColor: '#2e59d9',
                    borderColor: '#4e73df',
                    borderWidth: 1
                }]
            },
            options: {
                maintainAspectRatio: false,
                scales: {
                    x: {
                        grid: {
                            display: false
                        }
                    },
                    y: {
                        beginAtZero: true,
                        ticks: {
                            precision: 0
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });

        // Letters by Month Chart
        var ctx2 = document.getElementById('lettersByMonthChart');
        var lettersByMonthChart = new Chart(ctx2, {
            type: 'line',
            data: {
                labels: @Html.Raw(Json.Encode(ViewBag.Months)),
                datasets: [{
                    label: 'Letters',
                    data: @Html.Raw(Json.Encode(ViewBag.LettersByMonth)),
                    backgroundColor: 'rgba(78, 115, 223, 0.05)',
                    borderColor: '#4e73df',
                    pointBackgroundColor: '#4e73df',
                    pointBorderColor: '#4e73df',
                    pointHoverBackgroundColor: '#4e73df',
                    pointHoverBorderColor: '#4e73df',
                    pointRadius: 3,
                    pointHoverRadius: 5,
                    fill: true
                }]
            },
            options: {
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    x: {
                        grid: {
                            display: false
                        }
                    },
                    y: {
                        beginAtZero: true,
                        ticks: {
                            precision: 0
                        }
                    }
                }
            }
        });

        // Letter Type Chart
        var ctx3 = document.getElementById('letterTypeChart');
        var letterTypeChart = new Chart(ctx3, {
            type: 'doughnut',
            data: {
                labels: ['Inward', 'Outward'],
                datasets: [{
                    data: [@ViewBag.TotalInward, @ViewBag.TotalOutward],
                    backgroundColor: ['#4e73df', '#1cc88a'],
                    hoverBackgroundColor: ['#2e59d9', '#17a673'],
                    hoverBorderColor: "rgba(234, 236, 244, 1)",
                }],
            },
            options: {
                maintainAspectRatio: false,
                plugins: {
                    tooltip: {
                        backgroundColor: "rgb(255,255,255)",
                        bodyFontColor: "#858796",
                        borderColor: '#dddfeb',
                        borderWidth: 1,
                        xPadding: 15,
                        yPadding: 15,
                        displayColors: false,
                        caretPadding: 10,
                    },
                    legend: {
                        display: false
                    },
                    datalabels: {
                        formatter: (value, ctx) => {
                            let sum = ctx.dataset.data.reduce((a, b) => a + b, 0);
                            let percentage = (value * 100 / sum).toFixed(1) + "%";
                            return percentage;
                        },
                        color: '#fff',
                    }
                },
                cutout: '80%',
            },
            plugins: [ChartDataLabels]
        });

        // Priority Chart
        var ctx4 = document.getElementById('priorityChart');
        var priorityChart = new Chart(ctx4, {
            type: 'pie',
            data: {
                labels: @Html.Raw(Json.Encode(ViewBag.PriorityLabels)),
                datasets: [{
                    data: @Html.Raw(Json.Encode(ViewBag.PriorityData)),
                    backgroundColor: ['#4e73df', '#1cc88a', '#f6c23e', '#e74a3b'],
                    hoverBackgroundColor: ['#2e59d9', '#17a673', '#dda20a', '#be2617'],
                    hoverBorderColor: "rgba(234, 236, 244, 1)",
                }],
            },
            options: {
                maintainAspectRatio: false,
                plugins: {
                    tooltip: {
                        backgroundColor: "rgb(255,255,255)",
                        bodyFontColor: "#858796",
                        borderColor: '#dddfeb',
                        borderWidth: 1,
                        xPadding: 15,
                        yPadding: 15,
                        displayColors: false,
                        caretPadding: 10,
                    },
                    legend: {
                        position: 'right'
                    },
                    datalabels: {
                        formatter: (value, ctx) => {
                            let sum = ctx.dataset.data.reduce((a, b) => a + b, 0);
                            let percentage = (value * 100 / sum).toFixed(1) + "%";
                            return percentage;
                        },
                        color: '#fff',
                    }
                },
            },
            plugins: [ChartDataLabels]
        });

        // Status Chart
        var ctx5 = document.getElementById('statusChart');
        var statusChart = new Chart(ctx5, {
            type: 'pie',
            data: {
                labels: @Html.Raw(Json.Encode(ViewBag.StatusLabels)),
                datasets: [{
                    data: @Html.Raw(Json.Encode(ViewBag.StatusData)),
                    backgroundColor: ['#4e73df', '#1cc88a', '#f6c23e', '#e74a3b'],
                    hoverBackgroundColor: ['#2e59d9', '#17a673', '#dda20a', '#be2617'],
                    hoverBorderColor: "rgba(234, 236, 244, 1)",
                }],
            },
            options: {
                maintainAspectRatio: false,
                plugins: {
                    tooltip: {
                        backgroundColor: "rgb(255,255,255)",
                        bodyFontColor: "#858796",
                        borderColor: '#dddfeb',
                        borderWidth: 1,
                        xPadding: 15,
                        yPadding: 15,
                        displayColors: false,
                        caretPadding: 10,
                    },
                    legend: {
                        position: 'right'
                    },
                    datalabels: {
                        formatter: (value, ctx) => {
                            let sum = ctx.dataset.data.reduce((a, b) => a + b, 0);
                            let percentage = (value * 100 / sum).toFixed(1) + "%";
                            return percentage;
                        },
                        color: '#fff',
                    }
                },
            },
            plugins: [ChartDataLabels]
        });

        // Sender Departments Chart
        var ctx6 = document.getElementById('senderDepartmentsChart');
        var senderDepartmentsChart = new Chart(ctx6, {
            type: 'bar',
            data: {
                labels: @Html.Raw(Json.Encode(ViewBag.SenderDepartments)),
                datasets: [{
                    label: 'Letters Received',
                    data: @Html.Raw(Json.Encode(ViewBag.SenderDepartmentCounts)),
                    backgroundColor: '#1cc88a',
                    hoverBackgroundColor: '#17a673',
                    borderColor: '#1cc88a',
                    borderWidth: 1
                }]
            },
            options: {
                maintainAspectRatio: false,
                scales: {
                    x: {
                        grid: {
                            display: false
                        }
                    },
                    y: {
                        beginAtZero: true,
                        ticks: {
                            precision: 0
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });

        // Processing Time Chart
        var ctx7 = document.getElementById('processingTimeChart');
        var processingTimeChart = new Chart(ctx7, {
            type: 'line',
            data: {
                labels: @Html.Raw(Json.Encode(ViewBag.ProcessingTimeMonths)),
                datasets: [{
                    label: 'Average Days',
                    data: @Html.Raw(Json.Encode(ViewBag.ProcessingTimeData)),
                    backgroundColor: 'rgba(78, 115, 223, 0.05)',
                    borderColor: '#4e73df',
                    pointBackgroundColor: '#4e73df',
                    pointBorderColor: '#4e73df',
                    pointHoverBackgroundColor: '#4e73df',
                    pointHoverBorderColor: '#4e73df',
                    pointRadius: 3,
                    pointHoverRadius: 5,
                    fill: true
                }]
            },
            options: {
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    x: {
                        grid: {
                            display: false
                        }
                    },
                    y: {
                        beginAtZero: true,
                        ticks: {
                            precision: 1
                        }
                    }
                }
            }
        });
    </script>
}